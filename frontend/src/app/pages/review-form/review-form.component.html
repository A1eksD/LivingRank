<div class="page-container">
  @if (street) {
    <h2>Bewertung schreiben</h2>
    <p class="street-info">
      <i class="pi pi-map-marker"></i>
      {{ street.streetName }}, {{ street.postalCode }} {{ street.city }}
    </p>

    <p-card styleClass="mt-3">
      <div class="anonymous-notice mb-3">
        <i class="pi pi-shield"></i>
        Ihre Bewertung wird anonym veröffentlicht. Kein Klarname wird angezeigt.
      </div>

      @if (error) {
        <p-message severity="error" [text]="error" styleClass="mb-3" />
      }

      <!-- Overall Rating -->
      <div class="form-group overall-rating-group">
        <label>Gesamtbewertung *</label>
        <p-rating [(ngModel)]="review.overallRating" [stars]="5" />
      </div>

      <!-- Criteria Ratings -->
      <h3 class="mt-3 mb-2">Kriterien (optional)</h3>
      <div class="criteria-form">
        @for (key of criteriaKeys; track key) {
          <div class="form-group criteria-row">
            <label>{{ criteriaLabels[key] }}</label>
            <p-rating [(ngModel)]="criteria[key]" [stars]="5" />
          </div>
        }
      </div>

      <!-- Comment -->
      <div class="form-group mt-3">
        <label>Kommentar (optional, max. 2000 Zeichen)</label>
        <textarea pTextarea [(ngModel)]="review.comment" [rows]="5" [maxlength]="2000"
                  placeholder="Beschreiben Sie Ihre Erfahrungen mit dieser Straße/Nachbarschaft..."
                  [style]="{ width: '100%' }"></textarea>
        <small class="char-count">{{ commentLength }} / 2000</small>
      </div>

      <div class="form-actions mt-3">
        <p-button label="Bewertung absenden" icon="pi pi-check" (onClick)="submit()" [loading]="submitting" />
      </div>
    </p-card>
  }
</div>
